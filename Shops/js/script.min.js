const imgUser=localStorage.getItem("Image"),nameUser=localStorage.getItem("Name"),privUSer=localStorage.getItem("Priv"),emailUser=localStorage.getItem("Email");window.onload=function(){1==privUSer||(window.localStorage.clear(),location.href="../"),$("#imgUser").attr("src",imgUser),$("#nameUser").html(nameUser),$("#emailUser").html(emailUser)};const crud=new Firebase("https://adminoxxoparts.firebaseio.com/Oxxo/Shops/");crud.on("child_added",function(a){$("#tabla").append(carga(a.key(),a.val()))});function carga(){var a={};crud.orderByChild("CR").on("value",function(b){a=b.val();var c="",d="";$.each(a,function(e,f){c+="<thead class=\""+e+"\">",c+="<tr>",c+="<th>Estatus</th>",c+="<th>Nombre</th>",c+="<th>CR</th>",c+="<th>Cambiar estatus</th>",c+="<th>Editar</th>",c+="<th>Eliminar</th>",c+="</tr>",c+="</thead>",c+="<tbody class=\""+e+"\">",c+="<tr>",1==f.Status?(status="<span class=\"label bg-green\">Activo</span>",d="<a onclick=\"s_car('"+e+"',2)\" id=\"btn_"+e+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">block</i><br>Baja</a>"):2==f.Status&&(status="<span class=\"label bg-red\">Eliminado</span>",d="<a onclick=\"s_car('"+e+"',1)\" id=\"btn_"+e+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">check_circle</i><br>Reactivar</a>"),c+="<td>"+status+"</td>",c+="<td>"+f.Name+"</td>",c+="<td>"+f.CR+"</td>",c+="<td>"+d+"</td>",c+="<td><a onclick=\"rd_car('"+e+"')\" id=\"btn_"+e+"\" data-toggle=\"modal\" data-target=\"#myModal_n\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">create</i><br>Editar</a></td>",c+="<td><a onclick=\"d_car('"+e+"')\" id=\"btn_"+e+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">delete</i><br>Eliminar</a></td>",c+="</tr>",c+="</tbody>"}),$("#tabla").html(c),$(".lazy").lazy()})}crud.on("child_changed",function(a){a.val();$.toast({heading:"Modificado correctamente",showHideTransition:"slide",icon:"success"})});function n_car(){""!=$("#Name").val()&&""!=$("#CR").val()?($("#btn_car").attr("disabled","disabled"),$("#btn_car").removeAttr("onclick"),$.ajax({url:crud+".json",type:"POST",data:JSON.stringify({Name:$("#Name").val(),CR:$("#CR").val(),Status:1}),error:function(){},success:function(){$.toast({heading:"Registrado correctamente",showHideTransition:"slide",icon:"success"}),$("#btn_car").removeAttr("disabled"),$("#btn_car").attr("onclick","n_car()"),$("#car")[0].reset()}})):swal("Datos requeridos","Favor de llenar el campo del mensaje","error")}function d_car(a){$("#btn_"+a).removeAttr("onclick"),$.ajax({url:crud+"/"+a+".json",type:"DELETE",error:function(){},success:function(){}})}crud.on("child_removed",function(a){$("."+a.key()).hide(2e3),$.toast({heading:"Eliminado correctamente",showHideTransition:"slide",icon:"success"})});function rd_car(a){$.ajax({url:crud+"/"+a+".json",type:"GET",error:function(){},success:function(b){$("#btn_car").attr("onclick","rw('"+a+"')"),$("#Name").val(b.Name),$("#CR").val(b.CR),$("#title_name").html("Editar tienda")}})}function rw(a){$("#btn_car").attr("disabled","disabled"),$.ajax({url:crud+"/"+a+".json",type:"PATCH",data:JSON.stringify({Name:$("#Name").val(),CR:$("#CR").val()}),error:function(){},success:function(){$("#car")[0].reset(),$("#btn_car").attr("onclick","n_car()"),$("#btn_car").removeAttr("disabled"),$("#title_name").html("Nueva tienda")}})}function s_car(a,b){$.ajax({url:crud+"/"+a+".json",type:"PATCH",data:JSON.stringify({Status:b}),error:function(){},success:function(){}})}