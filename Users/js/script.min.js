const imgUser=localStorage.getItem("Image"),nameUser=localStorage.getItem("Name"),privUSer=localStorage.getItem("Priv"),emailUser=localStorage.getItem("Email");var storageService=firebase.storage();window.onload=function(){1==privUSer||(window.localStorage.clear(),location.href="../"),$("#imgUser").attr("src",imgUser),$("#nameUser").html(nameUser),$("#emailUser").html(emailUser)};const crud=new Firebase("https://adminoxxoparts.firebaseio.com/Oxxo/Users/");crud.on("child_added",function(a){$("#tabla").append(carga(a.key(),a.val()))});function carga(){var a={};crud.orderByChild("model").on("value",function(b){a=b.val();var c="";$.each(a,function(d,e){c+="<thead class=\""+d+"\">",c+="<tr>",c+="<th>Estatus</th>",c+="<th>Nombre</th>",c+="<th>Email</th>",c+="<th>Privilegio</th>",c+="<th>Imagen</th>",c+="<th>Cambiar estatus</th>",c+="<th>Cambiar Privilegio</th>",c+="<th>Eliminar</th>",c+="</tr>",c+="</thead>",c+="<tbody class=\""+d+"\">",c+="<tr>",1==e.Status?(status="<span class=\"label bg-green\">Activo</span>",btn_status="<a onclick=\"s_car('"+d+"',2)\" id=\"btn_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">block</i><br>Baja</a>"):2==e.Status?(status="<span class=\"label bg-red\">Baja</span>",btn_status="<a onclick=\"s_car('"+d+"',1)\" id=\"btn_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">new_releases</i><br>Reactivar</a>"):0==e.Privilege&&(status="<span class=\"label bg-orange\">Nuevo</span>",btn_status="<br><a onclick=\"s_car('"+d+"',1)\" id=\"btn_p_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">fiber_new</i><br>Activar</a><br><br><br>"),0==e.Privilege?(privilege="<span class=\"label bg-orange\">Nuevo</span>",btn_privilege="<br><a onclick=\"p_car('"+d+"',1)\" id=\"btn_p_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">verified_user</i><br>Administrador</a><br><br><br>",btn_privilege+="<a onclick=\"p_car('"+d+"',2)\" id=\"btn_p_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">check_circle</i><br>Usuario</a>"):1==e.Privilege?(privilege="<span class=\"label bg-green\">Administrador</span>",btn_privilege="<a onclick=\"p_car('"+d+"',2)\" id=\"btn_p_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">check_circle</i><br>Usuario</a>"):2==e.Privilege&&(privilege="<span class=\"label bg-blue\">Usuario</span>",btn_privilege="<a onclick=\"p_car('"+d+"',1)\" id=\"btn_p_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">verified_user</i><br>Administrador</a>"),c+="<td>"+status+"</td>",c+="<td><strong>"+e.Name+"</strong></td>",c+="<td><a href='mailto:"+e.Email+"' title='Enviar correo'><b>"+e.Email+"</b></a></td>",c+="<td>"+privilege+"</td>",c+=""==e.Image?"<td><h5>Usuario sin imagen</h5></td>":"<td><img src="+e.Image+" width=\"160px\" alt=\""+e.Name+"\" title=\""+e.Name+"\"></td>",c+="<td>"+btn_status+"</td>",c+="<td>"+btn_privilege+"</td>",c+="<td><a onclick=\"d_car('"+d+"')\" id=\"btn_"+d+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">delete</i><br>Eliminar</a></td>",c+="</tr>",c+="</tbody>"}),$("#tabla").html(c)})}crud.on("child_changed",function(a){a.val();$.toast({heading:"Modificado correctamente",showHideTransition:"slide",icon:"success"})});function d_car(a){$("#btn_"+a).removeAttr("onclick"),$.ajax({url:crud+"/"+a+".json",type:"DELETE",error:function(){},success:function(){}})}crud.on("child_removed",function(a){$("."+a.key()).hide(2e3),$.toast({heading:"Eliminado correctamente",showHideTransition:"slide",icon:"success"})});function s_car(a,b){$.ajax({url:crud+"/"+a+".json",type:"PATCH",data:JSON.stringify({Status:b}),error:function(){},success:function(){}})}function p_car(a,b){$.ajax({url:crud+"/"+a+".json",type:"PATCH",data:JSON.stringify({Privilege:b}),error:function(){},success:function(){}})}