const imgUser=localStorage.getItem("Image"),nameUser=localStorage.getItem("Name"),privUSer=localStorage.getItem("Priv"),emailUser=localStorage.getItem("Email");var storageService=firebase.storage();window.onload=function(){1==privUSer||(window.localStorage.clear(),location.href="../"),$("#imgUser").attr("src",imgUser),$("#nameUser").html(nameUser),$("#emailUser").html(emailUser),document.getElementById("campoarchivo").addEventListener("change",function(a){a.preventDefault(),$("#btn_car").hide(),$("#Image_text").show();var b=a.target.files[0];subirArchivo(b)})};function subirArchivo(a){var b=storageService.ref("oxxo-parts").child(a.name),c=b.put(a);c.on("state_changed",null,function(){},function(){mensajeFinalizado(c.snapshot.downloadURL,c.snapshot.totalBytes)})}function mensajeFinalizado(a){$("#Image").val(a),""!=$("#Image").val()&&($("#btn_car").show(),$("#Image_text").hide())}const crud=new Firebase("https://adminoxxoparts.firebaseio.com/Oxxo/Parts/");crud.on("child_added",function(a){$("#tabla").append(carga(a.key(),a.val()))});function carga(){var a={};crud.orderByChild("model").on("value",function(b){a=b.val();var c="",d="";$.each(a,function(e,f){c+="<thead class=\""+e+"\">",c+="<tr>",c+="<th>Estatus</th>",c+="<th>Nombre</th>",c+="<th>Modelo</th>",c+="<th>Descripcion</th>",c+="<th>Proveedor</th>",c+="<th>Stock</th>",c+="<th>Imagen</th>",c+="<th>Cambiar estatus</th>",c+="<th>Editar</th>",c+="<th>Eliminar</th>",c+="</tr>",c+="</thead>",c+="<tbody class=\""+e+"\">",c+="<tr>",1==f.Status?(status="<span class=\"label bg-green\">Activo</span>",d="<a onclick=\"s_car('"+e+"',2)\" id=\"btn_"+e+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">block</i><br>Baja</a>"):2==f.Status&&(status="<span class=\"label bg-red\">Eliminado</span>",d="<a onclick=\"s_car('"+e+"',1)\" id=\"btn_"+e+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">check_circle</i><br>Reactivar</a>"),0==f.Stock&&(status="<span class=\"label bg-orange\">Sin Existencia</span>");var g="'"+f.Image+"'",h="'"+f.Name+"'",i="'"+f.Model+"'";c+="<td>"+status+"</td>",c+="<td><a href=\"https://www.google.com.mx/search?q="+f.Name+"\" target=\"_blank\">"+f.Name+"</a></td>",c+="<td><a href='https://www.google.com.mx/search?q="+f.Model+"' target='_blank'>"+f.Model+"</a></td>",c+="<td>"+f.Description+"</td>",c+="<td>"+f.Provider+"</td>",c+="<td><b>"+f.Stock+"</b></td>",c+=""==f.Image?"<td><h5>Articulo sin imagen</h5></td>":"<td><a onclick=\"modal_ver("+g+","+h+","+i+")\" data-toggle=\"modal\" data-target=\"#modal-ver\" title=\"Ver imagen\"><img data-src="+f.Image+" class=\"lazy\" width=\"160px\" alt=\""+f.Model+"\"></td>",c+="<td>"+d+"</td>",c+="<td><a onclick=\"rd_car('"+e+"')\" id=\"btn_"+e+"\" data-toggle=\"modal\" data-target=\"#myModal_n\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">create</i><br>Editar</a></td>",c+="<td><a onclick=\"d_car('"+e+"')\" id=\"btn_"+e+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">delete</i><br>Eliminar</a></td>",c+="</tr>",c+="</tbody>"}),$("#tabla").html(c),$(".lazy").lazy()})}crud.on("child_changed",function(a){a.val();$.toast({heading:"Modificado correctamente",showHideTransition:"slide",icon:"success"})});function n_car(){""!=$("#Name").val()&&""!=$("#Model").val()&&""!=$("#Description").val()&&""!=$("#Provider").val()&&""!=$("#Stock").val()?($("#btn_car").attr("disabled","disabled"),$("#btn_car").removeAttr("onclick"),$.ajax({url:crud+".json",type:"POST",data:JSON.stringify({Name:$("#Name").val(),Model:$("#Model").val(),Description:$("#Description").val(),Provider:$("#Provider").val(),Stock:$("#Stock").val(),Image:$("#Image").val(),Status:1}),error:function(){},success:function(){$.toast({heading:"Registrado correctamente",showHideTransition:"slide",icon:"success"}),$("#btn_car").removeAttr("disabled"),$("#btn_car").attr("onclick","n_car()"),$("#car")[0].reset()}})):swal("Datos requeridos","Favor de llenar el campo del mensaje","error")}function d_car(a){$("#btn_"+a).removeAttr("onclick"),$.ajax({url:crud+"/"+a+".json",type:"DELETE",error:function(){},success:function(){}})}crud.on("child_removed",function(a){$("."+a.key()).hide(2e3),$.toast({heading:"Eliminado correctamente",showHideTransition:"slide",icon:"success"})});function rd_car(a){$.ajax({url:crud+"/"+a+".json",type:"GET",error:function(){},success:function(b){$("#btn_car").attr("onclick","rw('"+a+"')"),$("#Name").val(b.Name),$("#Model").val(b.Model),$("#Description").val(b.Description),$("#Provider").val(b.Provider),$("#Image").val(b.Image),$("#Stock").val(b.Stock),$("#title_name").html("Editar pieza")}})}function rw(a){$("#btn_car").attr("disabled","disabled"),$.ajax({url:crud+"/"+a+".json",type:"PATCH",data:JSON.stringify({Name:$("#Name").val(),Model:$("#Model").val(),Description:$("#Description").val(),Provider:$("#Provider").val(),Image:$("#Image").val(),Stock:$("#Stock").val()}),error:function(){},success:function(){$("#car")[0].reset(),$("#btn_car").attr("onclick","n_car()"),$("#btn_car").removeAttr("disabled"),$("#title_name").html("Nueva pieza")}})}function s_car(a,b){$.ajax({url:crud+"/"+a+".json",type:"PATCH",data:JSON.stringify({Status:b}),error:function(){},success:function(){}})}function modal_ver(a,b,c){$("#imagen_ver_modal").attr("src",a),$("#name_ver_modal").html("<a href='https://www.google.com.mx/search?q="+b+"' target='_blank'>"+b+"</a>"),$("#model_ver_modal").html("<a href='https://www.google.com.mx/search?q="+c+"' target='_blank'>"+c+"</a>")}