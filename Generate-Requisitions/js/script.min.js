const crud=new Firebase("https://adminoxxoparts.firebaseio.com/Oxxo/"),imgUser=localStorage.getItem("Image"),nameUser=localStorage.getItem("Name"),privUSer=localStorage.getItem("Priv"),emailUser=localStorage.getItem("Email"),Token=localStorage.getItem("TokenAccess"),date=new Date,d=document,c=console.log,btn_car_send=d.getElementById("btn_car_send");window.onload=function(){1==privUSer?$(".user").hide():2==privUSer?$(".admin").hide():(window.localStorage.clear(),location.href="../"),$("#imgUser").attr("src",imgUser),$("#nameUser").html(nameUser),$("#emailUser").html(emailUser),null===localStorage.getItem("headerRequisition")||localStorage.getItem("headerRequisition")===void 0||""===localStorage.getItem("headerRequisition")?$.ajax({url:crud.child("Requisitions")+".json",type:"POST",data:JSON.stringify({Date_S:date.toJSON().slice(0,10).replace(/-/g,"/"),Users:Token,nameUser:nameUser,Status:2}),beforeSend:function(){},error:function(){},success:function(a){localStorage.setItem("headerRequisition",a.name),$("#headerRequisition").val(localStorage.getItem("headerRequisition"))}}):$("#headerRequisition").val(localStorage.getItem("headerRequisition"))};const RequisitionsGenerate=new Firebase("https://adminoxxoparts.firebaseio.com/Oxxo/Requisitions/");crud.child("Shops").on("child_added",function(a){$("#tabla_moda").append(carga_shops(a.key(),a.val()))}),crud.child("Shops").on("child_removed",function(a){$("."+a.key()).hide(2e3)}),crud.child("Shops").on("child_changed",function(a){});function carga_shops(){var a={};crud.child("Shops").on("value",function(b){a=b.val();var e="<option value=\"\">Seleccione CR</option>";return $.each(a,function(f,g){e+="<option value=\""+g.CR+"\">"+g.Name+"</option>"}),$(".Shops").html(e)})}crud.on("child_added",function(a){$("#tabla").append(carga(a.key(),a.val()))}),crud.on("child_removed",function(a){$("."+a.key()).hide(2e3)}),crud.on("child_changed",function(a){a.val()});function carga(){if(""===$("#buscar").val())var a;else{var a=$("#buscar").val();a=a.toLowerCase()}var b={};crud.child("Parts").on("value",function(e){b=e.val();var f="",g="",h,j=1;$.each(b,function(k,l){if(1==l.Status)if(null===a||void 0===a||""===a){f+="<thead class=\""+k+"\">",f+="<tr>",f+="<th>Estatus</th>",f+="<th>Nombre & Modelo</th>",f+="<th>Stock</th>",f+="<th style=\"padding-right:220px !important\">CR</th>",f+="<th>Imagen</th>",f+="<th>A\xF1adir al carrito</th>",f+="</tr>",f+="</thead>",f+="<tbody class=\""+k+"\">",f+="<tr>";var m="'"+l.Image+"'",n="'"+l.Name+"'",o="'"+l.Model+"'",p="'"+l.Description+"'",q="'"+k+"'";status="<span class=\"label bg-green\">Activo</span>",(0==l.Stock||null==l.Stock||void 0==l.Stock)&&(status="<span class=\"label bg-orange\">Sin existencia</span>",j=2),g="<button class=\"btn btn-info\" onclick=\"add_car("+q+","+m+","+n+","+o+", "+j+")\" id=\"btn_"+k+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">add_shopping_cart</i></b>",f+="<td style=\"font-size:18px;\">"+status+"</td>",f+="<td><p>"+l.Name+"</p><p><b>"+l.Model+"</b></p></td>",f+="<td><b>"+l.Stock+"</b></td>",f+="<td><div class=\"col-md-12 col-xs-12\" ><div class=\"input-group\" ><span class=\"input-group-addon\" ><i class=\"material-icons\" > store</i> </span> <div class=\"form-line\" ><select class=\"form-control Shops\" id=\"Shops"+k+"\" style=\"width:100% !important;\"></select></div> </div> </div></td>",f+=""==l.Image?"<td><h5>Articulo sin imagen</h5><br><div class=\"col-md-12 col-xs-12\" ><div class=\"input-group\" ><span class=\"input-group-addon\" ><i class=\"material-icons\" > format_list_numbered</i> </span> <div class=\"form-line\" ><input type=\"number\" min=\"1\" value=\"1\" id=\"quantity"+k+"\" class=\"form-control validate\" required placeholder=\"Cantidad \"></div> </div> </div></td>":"<td><a onclick=\"modal_ver("+m+","+n+","+o+", "+p+")\" data-toggle=\"modal\" data-target=\"#modal-ver\" title=\"Ver imagen\"><img data-src="+l.Image+" class=\"lazy\" width=\"160px\" alt=\""+l.Model+"\"><br></a><label for=\"quantity"+k+"\"><b>Cantidad:</b></label><div class=\"col-md-12 col-xs-12\" ><div class=\"input-group\" ><span class=\"input-group-addon\" ><i class=\"material-icons\" > format_list_numbered</i> </span> <div class=\"form-line\" ><input type=\"number\" min=\"1\" value=\"1\" id=\"quantity"+k+"\" class=\"form-control validate\" required placeholder=\"Cantidad \"></div> </div> </div></td>",f+="<td>"+g+"</td>",f+="</tr>",f+="</tbody>"}else if(l.Name.toLowerCase().match(a)){f+="<thead class=\""+k+"\">",f+="<tr>",f+="<th>Estatus</th>",f+="<th>Nombre & Modelo</th>",f+="<th>Stock</th>",f+="<th style=\"padding-right:220px !important\">CR</th>",f+="<th>Imagen</th>",f+="<th>A\xF1adir al carrito</th>",f+="</tr>",f+="</thead>",f+="<tbody class=\""+k+"\">",f+="<tr>";var m="'"+l.Image+"'",n="'"+l.Name+"'",o="'"+l.Model+"'",p="'"+l.Description+"'",q="'"+k+"'";(0==l.Stock||null==l.Stock||void 0==l.Stock)&&(status="<span class=\"label bg-orange\">Sin existencia</span>",j=2),status="<span class=\"label bg-green\">Activo</span>",g="<button class=\"btn btn-info\" onclick=\"add_car("+q+","+m+","+n+","+o+", "+j+")\" id=\"btn_"+k+"\" style=\"cursor:pointer !important;\"><i class=\"material-icons\">add_shopping_cart</i></b>",f+="<td style=\"font-size:18px;\">"+status+"</td>",f+="<td><p>"+l.Name+"</p><p><b>"+l.Model+"</b></p></td>",f+="<td><b>"+l.Stock+"</b></td>",f+="<td><div class=\"col-md-12 col-xs-12\" ><div class=\"input-group\" ><span class=\"input-group-addon\" ><i class=\"material-icons\" > store</i> </span> <div class=\"form-line\" ><select class=\"form-control Shops\" id=\"Shops"+k+"\" style=\"width:100% !important;\"></select></div> </div> </div></td>",f+=""==l.Image?"<td><h5>Articulo sin imagen</h5><br><div class=\"col-md-12 col-xs-12\" ><div class=\"input-group\" ><span class=\"input-group-addon\" ><i class=\"material-icons\" > format_list_numbered</i> </span> <div class=\"form-line\" ><input type=\"number\" min=\"1\" value=\"1\" id=\"quantity"+k+"\" class=\"form-control validate\" required placeholder=\"Cantidad \"></div> </div> </div></td>":"<td><a onclick=\"modal_ver("+m+","+n+","+o+", "+p+")\" data-toggle=\"modal\" data-target=\"#modal-ver\" title=\"Ver imagen\"><img data-src="+l.Image+" class=\"lazy\" width=\"160px\" alt=\""+l.Model+"\"><br></a><label for=\"quantity"+k+"\"><b>Cantidad:</b></label><div class=\"col-md-12 col-xs-12\" ><div class=\"input-group\" ><span class=\"input-group-addon\" ><i class=\"material-icons\" > format_list_numbered</i> </span> <div class=\"form-line\" ><input type=\"number\" min=\"1\" value=\"1\" id=\"quantity"+k+"\" class=\"form-control validate\" required placeholder=\"Cantidad \"></div> </div> </div></td>",f+="<td>"+g+"</td>",f+="</tr>",f+="</tbody>"}else h=0}),null===h||h===void 0||""===h||(f+="<h2 style=\"text-align:center !important;\">No se encontraron coincidencias para <strong>\""+a+"\"</strong></h2>"),$("#tabla").html(f),$(".lazy").lazy(),carga_shops()})}RequisitionsGenerate.on("child_added",function(a){$("#tabla_moda").html(carga_nuevo(a.key(),a.val()))}),RequisitionsGenerate.child(localStorage.getItem("headerRequisition")).on("child_removed",function(a){$("."+a.key()).hide(2e3),$.toast({heading:"Eliminado de la requisicion",showHideTransition:"slide",icon:"success"})}),RequisitionsGenerate.on("child_changed",function(a){});function carga_nuevo(){var a={};RequisitionsGenerate.child(localStorage.getItem("headerRequisition")).on("value",function(b){a=b.val();var e=1,f=0;$.each(a,function(g,h){if(h.Quantity==void 0||null==h.Quantity||""==h.Quantity);else{e+="";var i="'"+g+"'",j="'"+h.Parts+"'";f++,e+="<thead class=\"cart_body"+g+"\">",e+="<tr>",e+="<th>#</th>",e+="<th>Nombre</th>",e+="<th>Modelo</th>",e+="<th>CR</th>",e+="<th style='padding-right:60px !important'>Cantidad</th>",e+="<th>Eliminar</th>",e+="</tr>",e+="</thead>",e+="<td><p>"+f+"</p></td>",e+="<td><p>"+h.namePart+"</p></td>",e+="<td><p>"+h.modelPart+"</p></td>",e+="<td><p>"+h.Shops+"</p></td>",e+="<td><div class=\"col-md-12 col-xs-12\" ><div class=\"input-group\" ><span class=\"input-group-addon\" ><i class=\"material-icons\" > format_list_numbered</i> </span> <div class=\"form-line\" ><input type=\"number\" class=\"form-control\" id=\"i_change"+g+"\" min=\"0\" value=\""+h.Quantity+"\" onchange=\"rw_q("+i+")\" placeholder=\"Cantidad\" ></div> </div> </div></td>",e+="<td><button class=\"btn btn-danger\" onclick=\"d_car("+i+", "+j+")\" title=\"Eliminar "+h.namePart+"\"><i class=\"material-icons\">remove_shopping_cart</i></button></td>",e+="</tr>",e+="</tbody>"}}),1===e?($("#loader_modal").show(),$("#loader_modal").html("<h2 style=\"text-align:center !important;\"><strong>Carrito vacio</strong></h2>"),$("#tabla_modal").hide(),$("#btn_car_send").hide()):($("#loader_modal").hide(),$("#btn_car_send").show(),$("#tabla_modal").show(),$("#tabla_modal").html(e)),$(".c_noti").html(f)})}function add_car(a,b,e,f,g){""==$("#Shops"+a).val()||""==d.getElementById("quantity"+a).value||0>=d.getElementById("quantity"+a).value?swal("Datos requeridos","Favor de verificar que todos los campos esten llenos.","warning"):($("#btn_"+a).attr("disabled","disabled"),$.ajax({url:RequisitionsGenerate+"/"+$("#headerRequisition").val()+".json",type:"POST",data:JSON.stringify({Parts:a,Date_S:date.toJSON().slice(0,10).replace(/-/g,"/"),Users:Token,namePart:e,modelPart:f,imagePart:b,nameUser:nameUser,Quantity:d.getElementById("quantity"+a).value,Shops:$("#Shops"+a).val(),statusChange:g}),beforeSend:function(){},error:function(){},success:function(h){h===void 0||null===h||""===h||($("#Shops"+a).val(""),d.getElementById("quantity"+a).value="1",$("#btn_"+a).removeAttr("disabled"),$.toast({heading:"Agregado a la requisicion",showHideTransition:"slide",icon:"success"}))}}))}function d_car(a,b){$("#btn_"+a).removeAttr("onclick"),$.ajax({url:RequisitionsGenerate.child(localStorage.getItem("headerRequisition"))+"/"+a+".json",type:"DELETE",error:function(){},success:function(){$("."+b).show()}})}function rw_q(a){0>=$("#i_change"+a).val()||$("#i_change"+a).val()==void 0||null==$("#i_change"+a).val()||0==$("#i_change"+a).val()||""==$("#i_change"+a).val()||$.ajax({url:RequisitionsGenerate.child(localStorage.getItem("headerRequisition"))+"/"+a+".json",type:"PATCH",data:JSON.stringify({Quantity:$("#i_change"+a).val()}),error:function(){},success:function(b){b===void 0||null===b||""===b||$.toast({heading:"Cantidad actualizada.",showHideTransition:"slide",icon:"success"})}})}function modal_ver(a,b,e,f){$("#imagen_ver_modal").attr("src",a),$("#modal_ver_description").html("<div style=\"text-align:center !important;  word-wrap: break-word !important;\"><p style=\"font-size:15px;\">"+f+"</p><br>")}btn_car_send.addEventListener("click",()=>{swal({title:"Enviando requisicion...",text:"En breve sera revisada y respondida la autorizacion de las piezas...",type:"success",timer:3e3,showCancelButton:!1,showConfirmButton:!1,closeOnConfirm:!1,closeOnCancel:!1,allowEscapeKey:!1},function(){localStorage.removeItem("headerRequisition"),(localStorage.getItem("headerRequisition")===void 0||null===localStorage.getItem("headerRequisition")||""===localStorage.getItem("headerRequisition"))&&(location.href="../Requisitions/")})});